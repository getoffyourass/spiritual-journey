<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Bible</title>
    <script src="https://unpkg.com/react@17.0.2/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17.0.2/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.26.0/babel.min.js"></script>
    <script src="https://unpkg.com/react-router-dom@5.2.0/umd/react-router-dom.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2563eb;
            --background-color: #ffffff;
            --text-color: #1a1a1a;
            --secondary-text: #666666;
            --border-color: #e5e7eb;
            --hover-bg: #f3f4f6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--background-color);
            color: var(--text-color);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 768px;
            margin: 0 auto;
            padding: 1rem;
        }

        .header {
            position: sticky;
            top: 0;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            z-index: 100;
            padding: 1rem 0;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .select-wrapper {
            position: relative;
            flex: 1;
        }

        select {
            width: 100%;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            background: white;
            appearance: none;
            cursor: pointer;
            color: var(--text-color);
            font-family: inherit;
        }

        .select-wrapper::after {
            content: "â–¼";
            font-size: 0.8rem;
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--secondary-text);
            pointer-events: none;
        }

        .verse-container {
            padding: 2rem 1rem;
            text-align: center;
        }

        .verse-text {
            font-size: 1.5rem;
            line-height: 1.75;
            margin-bottom: 1.5rem;
            color: var(--text-color);
        }

        .verse-reference {
            font-size: 1rem;
            color: var(--secondary-text);
            font-weight: 500;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
            margin-top: 2rem;
        }

        .nav-button {
            padding: 0.75rem 1.5rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            background: white;
            color: var(--text-color);
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
            flex: 1;
            max-width: 150px;
        }

        .nav-button:hover {
            background: var(--hover-bg);
        }

        .nav-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: var(--text-color);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            animation: slideUp 0.3s ease;
            z-index: 1000;
        }

        @keyframes slideUp {
            from {
                transform: translate(-50%, 100%);
                opacity: 0;
            }
            to {
                transform: translate(-50%, 0);
                opacity: 1;
            }
        }

        /* Loading State */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
            color: var(--secondary-text);
        }

        .loading-spinner {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border-color);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 0.5rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Mobile Responsive */
        @media (max-width: 640px) {
            .container {
                padding: 0.5rem;
            }

            .verse-text {
                font-size: 1.25rem;
            }

            .nav-buttons {
                flex-direction: column;
                gap: 0.5rem;
            }

            .nav-button {
                max-width: none;
            }
        }
    </style>
</head> 
    <body>
    <div id="root"></div>

    <script type="text/babel">
        const { HashRouter, Route, Switch, useHistory } = ReactRouterDOM;
        const { useState, useEffect } = React;

        // Toast notification component
        function Toast({ message, onClose }) {
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, [onClose]);

            return <div className="toast">{message}</div>;
        }

        // Local Storage Hook
        function useLocalStorage(key, initialValue) {
            const [storedValue, setStoredValue] = useState(() => {
                try {
                    const item = window.localStorage.getItem(key);
                    return item ? JSON.parse(item) : initialValue;
                } catch (error) {
                    return initialValue;
                }
            });

            const setValue = value => {
                try {
                    setStoredValue(value);
                    window.localStorage.setItem(key, JSON.stringify(value));
                } catch (error) {
                    console.error(error);
                }
            };

            return [storedValue, setValue];
        }

        function BibleReader() {
            const [loading, setLoading] = useState(true);
            const [verses, setVerses] = useState([]);
            const [book, setBook] = useState(() => 
                localStorage.getItem('lastBook') || "John"
            );
            const [chapter, setChapter] = useState(() => 
                Number(localStorage.getItem('lastChapter')) || 1
            );
            const [translation, setTranslation] = useState(() => 
                localStorage.getItem('preferredTranslation') || 'web'
            );
            const [toast, setToast] = useState(null);
            const [error, setError] = useState(null);

            const translations = [
                { value: 'web', label: 'World English Bible' },
                { value: 'kjv', label: 'King James Version' },
                { value: 'bbe', label: 'Basic English Bible' }
            ];

            const books = [
                "Genesis", "Exodus", "Leviticus", "Numbers", "Deuteronomy",
                "Joshua", "Judges", "Ruth", "1 Samuel", "2 Samuel",
                "1 Kings", "2 Kings", "1 Chronicles", "2 Chronicles",
                "Ezra", "Nehemiah", "Esther", "Job", "Psalms",
                "Proverbs", "Ecclesiastes", "Song of Solomon", "Isaiah",
                "Jeremiah", "Lamentations", "Ezekiel", "Daniel", "Hosea",
                "Joel", "Amos", "Obadiah", "Jonah", "Micah", "Nahum",
                "Habakkuk", "Zephaniah", "Haggai", "Zechariah", "Malachi",
                "Matthew", "Mark", "Luke", "John", "Acts", "Romans",
                "1 Corinthians", "2 Corinthians", "Galatians", "Ephesians",
                "Philippians", "Colossians", "1 Thessalonians", "2 Thessalonians",
                "1 Timothy", "2 Timothy", "Titus", "Philemon", "Hebrews",
                "James", "1 Peter", "2 Peter", "1 John", "2 John", "3 John",
                "Jude", "Revelation"
            ];

            useEffect(() => {
                loadChapter();
                // Save last read location
                localStorage.setItem('lastBook', book);
                localStorage.setItem('lastChapter', chapter.toString());
            }, [book, chapter, translation]);

            const loadChapter = async () => {
                setLoading(true);
                setError(null);
                try {
                    const response = await fetch(
                        `https://bible-api.com/${book} ${chapter}?translation=${translation}`
                    );
                    if (!response.ok) throw new Error('Failed to load chapter');
                    const data = await response.json();
                    setVerses(data.verses);
                } catch (error) {
                    console.error('Error:', error);
                    setError('Error loading chapter. Please try again.');
                    setToast('Error loading chapter. Please try again.');
                } finally {
                    setLoading(false);
                }
            };

            const navigateChapter = (direction) => {
                if (direction === 'next') {
                    if (chapter < 150) { // Approximate max chapters
                        setChapter(prev => prev + 1);
                    } else if (books.indexOf(book) < books.length - 1) {
                        setBook(books[books.indexOf(book) + 1]);
                        setChapter(1);
                    }
                } else {
                    if (chapter > 1) {
                        setChapter(prev => prev - 1);
                    } else if (books.indexOf(book) > 0) {
                        setBook(books[books.indexOf(book) - 1]);
                        setChapter(150); // Will be adjusted by API if too high
                    }
                }
            };

            const copyVerse = (verse) => {
                const text = `${verse.text} - ${book} ${chapter}:${verse.verse}`;
                navigator.clipboard.writeText(text);
                setToast('Verse copied to clipboard');
            };

            if (loading) {
                return (
                    <div className="container">
                        <div className="loading">
                            <div className="loading-spinner" />
                            <span>Loading...</span>
                        </div>
                    </div>
                );
            }

            return (
                <div className="container">
                    <header className="header">
                        <div className="navigation">
                            <div className="select-wrapper">
                                <select
                                    value={book}
                                    onChange={(e) => {
                                        setBook(e.target.value);
                                        setChapter(1);
                                    }}
                                >
                                    {books.map(b => (
                                        <option key={b} value={b}>{b}</option>
                                    ))}
                                </select>
                            </div>
                            <div className="select-wrapper">
                                <select
                                    value={chapter}
                                    onChange={(e) => setChapter(Number(e.target.value))}
                                >
                                    {[...Array(150)].map((_, i) => (
                                        <option key={i + 1} value={i + 1}>
                                            Chapter {i + 1}
                                        </option>
                                    ))}
                                </select>
                            </div>
                            <div className="select-wrapper">
                                <select
                                    value={translation}
                                    onChange={(e) => {
                                        setTranslation(e.target.value);
                                        localStorage.setItem('preferredTranslation', e.target.value);
                                    }}
                                >
                                    {translations.map(t => (
                                        <option key={t.value} value={t.value}>{t.label}</option>
                                    ))}
                                </select>
                            </div>
                        </div>
                    </header>

                    <main>
                        {verses.map((verse) => (
                            <div key={verse.verse} className="verse-container" onClick={() => copyVerse(verse)}>
                                <div className="verse-text">{verse.text}</div>
                                <div className="verse-reference">
                                    {book} {chapter}:{verse.verse}
                                </div>
                            </div>
                        ))}

                        <div className="nav-buttons">
                            <button 
                                className="nav-button"
                                onClick={() => navigateChapter('prev')}
                                disabled={chapter === 1 && books.indexOf(book) === 0}
                            >
                                Previous
                            </button>
                            <button 
                                className="nav-button"
                                onClick={() => navigateChapter('next')}
                                disabled={chapter === 150 && books.indexOf(book) === books.length - 1}
                            >
                                Next
                            </button>
                        </div>
                    </main>

                    {toast && (
                        <Toast 
                            message={toast}
                            onClose={() => setToast(null)}
                        />
                    )}
                </div>
            );
        }

        function App() {
            return (
                <HashRouter>
                    <Switch>
                        <Route path="/" component={BibleReader} />
                    </Switch>
                </HashRouter>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
