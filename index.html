<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spiritual Journey</title>
    <script src="https://unpkg.com/react@17.0.2/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17.0.2/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.26.0/babel.min.js"></script>
    <script src="https://unpkg.com/react-router-dom@5.2.0/umd/react-router-dom.min.js"></script>
    <style>
        :root {
            --primary-color: #1a1a1a;
            --background-color: #ffffff;
            --card-background: #f8f8f8;
            --text-color: #333333;
            --blue-50: #e6f0ff;
            --blue-600: #2563eb;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--background-color);
            color: var(--text-color);
            padding-bottom: 80px;
        }

        /* ... previous styles remain the same ... */
        
        .nav-link {
            display: inline-block;
            margin-top: 1rem;
            padding: 0.75rem 1.5rem;
            background: var(--blue-600);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: background-color 0.2s;
        }

        .nav-link:hover {
            background: #1d4ed8;
        }

        /* Add all the previous styles here */
    </style>
</head>
<body>
    <div id="root"></div>
        <style>
        /* ... previous styles from Part 1 ... */

        /* Enhanced Mobile Responsive Styles */
        @media (max-width: 768px) {
            .app {
                padding: 10px;
            }

            .religion-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .reader-header {
                flex-direction: column;
                gap: 1rem;
            }

            .chapter-selector {
                flex-direction: column;
                width: 100%;
            }

            .chapter-selector select {
                width: 100%;
            }

            .translation-selector {
                width: 100%;
                margin-right: 0;
                margin-bottom: 1rem;
            }

            .bookmarks-panel {
                width: 100%;
            }
        }

        /* Reader Styles */
        .reader-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .reader-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1rem;
            background: var(--card-background);
            border-radius: 12px;
        }

        .reader-controls {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .chapter-selector {
            display: flex;
            gap: 1rem;
        }

        .chapter-selector select,
        .translation-selector {
            padding: 0.75rem;
            border-radius: 8px;
            border: 1px solid #eee;
            font-size: 0.9rem;
            background: white;
            min-width: 120px;
        }

        .reader-content {
            line-height: 1.8;
            font-size: 1.1rem;
            padding: 1.5rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .verse-container {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
            padding: 0.75rem;
            border-radius: 8px;
            transition: background-color 0.2s;
        }

        .verse-container:hover {
            background: var(--card-background);
        }

        .verse {
            display: flex;
            gap: 1rem;
            flex: 1;
        }

        .verse-number {
            color: var(--blue-600);
            font-weight: 500;
            min-width: 1.5rem;
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 100px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            background: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            animation: slideIn 0.3s ease-out;
            z-index: 1000;
            max-width: 90%;
        }

        .toast.success {
            background: #dcfce7;
            color: #16a34a;
        }

        .toast.error {
            background: #fee2e2;
            color: #dc2626;
        }

        .toast.info {
            background: var(--blue-50);
            color: var(--blue-600);
        }

        /* Bookmark Styles */
        .bookmarks-panel {
            position: fixed;
            right: 0;
            top: 0;
            bottom: 0;
            width: 350px;
            background: white;
            box-shadow: -2px 0 10px rgba(0,0,0,0.1);
            padding: 1.5rem;
            overflow-y: auto;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }

        .bookmark-item {
            padding: 1rem;
            border-radius: 8px;
            background: var(--card-background);
            margin-bottom: 1rem;
            transition: transform 0.2s;
        }

        .bookmark-item:hover {
            transform: translateY(-2px);
        }

        .bookmark-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .bookmark-category {
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
            background: var(--blue-50);
            color: var(--blue-600);
            border-radius: 4px;
        }

        .bookmark-notes {
            font-size: 0.9rem;
            color: #666;
            margin-top: 0.5rem;
            padding-left: 0.5rem;
            border-left: 2px solid #eee;
        }

        .bookmark-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        .bookmark-editor {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            width: 90%;
            max-width: 400px;
            z-index: 1100;
        }

        /* Animation Keyframes */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        /* Loading States */
        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--blue-600);
        }

        .loading-spinner {
            width: 24px;
            height: 24px;
            border: 3px solid var(--blue-50);
            border-top-color: var(--blue-600);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head> 
    <body>
    <div id="root"></div>

    <script type="text/babel">
        const { HashRouter, Route, Link, Switch, useHistory } = ReactRouterDOM;
        const { useState, useEffect } = React;

        // Toast notification component
        function Toast({ message, type = 'success', onClose }) {
            useEffect(() => {
                const timer = setTimeout(onClose, 3000);
                return () => clearTimeout(timer);
            }, [onClose]);

            return (
                <div className={`toast ${type}`}>
                    {message}
                </div>
            );
        }

        // Local Storage Hook
        function useLocalStorage(key, initialValue) {
            const [storedValue, setStoredValue] = useState(() => {
                try {
                    const item = window.localStorage.getItem(key);
                    return item ? JSON.parse(item) : initialValue;
                } catch (error) {
                    console.error(error);
                    return initialValue;
                }
            });

            const setValue = value => {
                try {
                    setStoredValue(value);
                    window.localStorage.setItem(key, JSON.stringify(value));
                } catch (error) {
                    console.error(error);
                }
            };

            return [storedValue, setValue];
        }

        function BibleReader() {
            const [loading, setLoading] = useState(true);
            const [verses, setVerses] = useState([]);
            const [book, setBook] = useState("Genesis");
            const [chapter, setChapter] = useState(1);
            const [translation, setTranslation] = useState(() => {
                return localStorage.getItem('preferredTranslation') || 'kjv';
            });
            const [bookmarks, setBookmarks] = useLocalStorage('bible-bookmarks', []);
            const [showBookmarks, setShowBookmarks] = useState(false);
            const [selectedCategory, setSelectedCategory] = useState('all');
            const [categories, setCategories] = useLocalStorage('bookmark-categories', [
                'Favorite',
                'Study',
                'Prayer',
                'Inspiration',
                'Custom'
            ]);
            const [editingBookmark, setEditingBookmark] = useState(null);
            const [toast, setToast] = useState(null);
            const [error, setError] = useState(null);
            const history = useHistory();

            const translations = [
                { value: 'kjv', label: 'King James Version' },
                { value: 'web', label: 'World English Bible' },
                { value: 'bbe', label: 'Bible in Basic English' }
            ];

            const books = [
                "Genesis", "Exodus", "Leviticus", "Numbers", "Deuteronomy",
                "Joshua", "Judges", "Ruth", "1 Samuel", "2 Samuel",
                "1 Kings", "2 Kings", "1 Chronicles", "2 Chronicles",
                "Ezra", "Nehemiah", "Esther", "Job", "Psalms",
                "Proverbs", "Ecclesiastes", "Song of Solomon", "Isaiah",
                "Jeremiah", "Lamentations", "Ezekiel", "Daniel", "Hosea",
                "Joel", "Amos", "Obadiah", "Jonah", "Micah", "Nahum",
                "Habakkuk", "Zephaniah", "Haggai", "Zechariah", "Malachi",
                "Matthew", "Mark", "Luke", "John", "Acts", "Romans",
                "1 Corinthians", "2 Corinthians", "Galatians", "Ephesians",
                "Philippians", "Colossians", "1 Thessalonians", "2 Thessalonians",
                "1 Timothy", "2 Timothy", "Titus", "Philemon", "Hebrews",
                "James", "1 Peter", "2 Peter", "1 John", "2 John", "3 John",
                "Jude", "Revelation"
            ];

            useEffect(() => {
                loadChapter();
            }, [book, chapter, translation]);

            const loadChapter = async () => {
                setLoading(true);
                setError(null);
                try {
                    const response = await fetch(`https://bible-api.com/${book} ${chapter}?translation=${translation}`);
                    if (!response.ok) throw new Error('Failed to load chapter');
                    const data = await response.json();
                    setVerses(data.verses);
                } catch (error) {
                    console.error('Error:', error);
                    setError('Error loading chapter. Please try again.');
                    setToast({
                        message: 'Error loading chapter. Please try again.',
                        type: 'error'
                    });
                } finally {
                    setLoading(false);
                }
            };
                        const toggleBookmark = (verse) => {
                const bookmarkKey = `${book} ${chapter}:${verse.verse}`;
                const bookmark = {
                    key: bookmarkKey,
                    book,
                    chapter,
                    verse: verse.verse,
                    text: verse.text,
                    translation,
                    category: 'Favorite',
                    notes: '',
                    dateAdded: new Date().toISOString()
                };

                setBookmarks(currentBookmarks => {
                    const exists = currentBookmarks.some(b => b.key === bookmarkKey);
                    if (exists) {
                        setToast({
                            message: 'Bookmark removed',
                            type: 'info'
                        });
                        return currentBookmarks.filter(b => b.key !== bookmarkKey);
                    } else {
                        setToast({
                            message: 'Bookmark added!',
                            type: 'success'
                        });
                        return [...currentBookmarks, bookmark];
                    }
                });
            };

            const BookmarksPanel = () => (
                <div className="bookmarks-panel">
                    <div className="bookmarks-header">
                        <h3>Your Bookmarks</h3>
                        <button className="close-button" onClick={() => setShowBookmarks(false)}>×</button>
                    </div>
                    <div className="category-filter">
                        <select
                            id="bookmark-category-filter"
                            name="bookmark-category"
                            value={selectedCategory}
                            onChange={(e) => setSelectedCategory(e.target.value)}
                        >
                            <option value="all">All Categories</option>
                            {categories.map(cat => (
                                <option key={cat} value={cat}>{cat}</option>
                            ))}
                        </select>
                    </div>
                    {bookmarks.length === 0 ? (
                        <p>No bookmarks yet</p>
                    ) : (
                        bookmarks
                            .filter(b => selectedCategory === 'all' || b.category === selectedCategory)
                            .map(bookmark => (
                                <div key={bookmark.key} className="bookmark-item">
                                    <div className="bookmark-header">
                                        <span>{bookmark.key}</span>
                                        <span className="bookmark-category">{bookmark.category}</span>
                                    </div>
                                    <div>{bookmark.text}</div>
                                    {bookmark.notes && (
                                        <div className="bookmark-notes">{bookmark.notes}</div>
                                    )}
                                </div>
                            ))
                    )}
                </div>
            );

            if (loading) {
                return (
                    <div className="reader-container">
                        <div className="loading">
                            <div className="loading-spinner" />
                            <p>Loading Bible text...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="reader-container">
                    <div className="reader-header">
                        <button className="back-button" onClick={() => history.push('/')}>
                            ← Back
                        </button>
                        <div className="reader-controls">
                            <select 
                                id="translation-select"
                                name="translation"
                                className="translation-selector"
                                value={translation}
                                onChange={(e) => {
                                    setTranslation(e.target.value);
                                    localStorage.setItem('preferredTranslation', e.target.value);
                                }}
                            >
                                {translations.map(t => (
                                    <option key={t.value} value={t.value}>{t.label}</option>
                                ))}
                            </select>
                            <div className="chapter-selector">
                                <select 
                                    id="book-select"
                                    name="book"
                                    value={book}
                                    onChange={(e) => {
                                        setBook(e.target.value);
                                        setChapter(1);
                                    }}
                                >
                                    {books.map(b => (
                                        <option key={b} value={b}>{b}</option>
                                    ))}
                                </select>
                                <select
                                    id="chapter-select"
                                    name="chapter"
                                    value={chapter}
                                    onChange={(e) => setChapter(Number(e.target.value))}
                                >
                                    {[...Array(150)].map((_, i) => (
                                        <option key={i + 1} value={i + 1}>Chapter {i + 1}</option>
                                    ))}
                                </select>
                            </div>
                        </div>
                    </div>

                    {error && <div className="error-message">{error}</div>}

                    <div className="reader-content">
                        {verses.map((verse) => (
                            <div key={verse.verse} className="verse-container">
                                <div className="verse">
                                    <span className="verse-number">{verse.verse}</span>
                                    <span>{verse.text}</span>
                                </div>
                                <button 
                                    className={`bookmark-button ${bookmarks.some(b => b.key === `${book} ${chapter}:${verse.verse}`) ? 'active' : ''}`}
                                    onClick={() => toggleBookmark(verse)}
                                >
                                    ★
                                </button>
                            </div>
                        ))}
                    </div>

                    <button 
                        className="bookmark-toggle"
                        onClick={() => setShowBookmarks(!showBookmarks)}
                    >
                        Bookmarks
                    </button>

                    {showBookmarks && <BookmarksPanel />}
                    {toast && (
                        <Toast 
                            message={toast.message}
                            type={toast.type}
                            onClose={() => setToast(null)}
                        />
                    )}
                </div>
            );
        }

        function Home() {
            const [selectedReligion, setSelectedReligion] = useState(null);
            
            return (
                <div className="app">
                    <div className="welcome-card">
                        <h1>Welcome to Your Spiritual Journey</h1>
                        <p>Select your faith to begin:</p>
                        
                        <div className="religion-grid">
                            {["Christianity", "Islam", "Hinduism", "Buddhism", "Judaism", "Spiritual"].map(religion => (
                                <div
                                    key={religion}
                                    className={`religion-card ${selectedReligion === religion ? 'selected' : ''}`}
                                    onClick={() => setSelectedReligion(religion)}
                                >
                                    {religion}
                                </div>
                            ))}
                        </div>
                        
                        {selectedReligion && (
                            <div className="selected-info">
                                <h3>You selected: {selectedReligion}</h3>
                                {selectedReligion === 'Christianity' && (
                                    <Link to="/bible" className="nav-link">
                                        Open Bible Reader
                                    </Link>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        function App() {
            return (
                <HashRouter>
                    <div>
                        <nav>
                            <Link to="/" className="logo">Spiritual Journey</Link>
                        </nav>
                        <Switch>
                            <Route exact path="/" component={Home} />
                            <Route path="/bible" component={BibleReader} />
                        </Switch>
                    </div>
                </HashRouter>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
